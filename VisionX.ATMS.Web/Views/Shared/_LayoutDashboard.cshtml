<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="~/images/icon.ico" />

    <!-- External Styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Leaflet CSS for OpenStreetMap -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <link rel="stylesheet" href="~/css/dashboard.css" />
    <link rel="stylesheet" href="~/css/alarms.css" />
    <link rel="stylesheet" href="~/css/analytics.css" />
    <link rel="stylesheet" href="~/css/planner.css" />
    <link rel="stylesheet" href="~/css/dms.css" />
    <link rel="stylesheet" href="~/css/nms.css" />
    <link rel="stylesheet" href="~/css/gismap.css" />
    <link rel="stylesheet" href="~/css/settings.css" />
    <link rel="stylesheet" href="~/css/vasd.css" />

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-section">
                    <img src="~/images/visionx_logo_flat.png" alt="VisionX Infrasys" class="logo" />
                </div>
                <button class="toggle-btn" id="toggleSidebar">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>

            <ul class="sidebar-menu">
                <li><a href="@Url.Action("Index", "Dashboard")"><i class="fa-solid fa-gauge"></i> <span>Dashboard</span></a></li>
                <li><a href="@Url.Action("Index", "Alarms")"><i class="fa-solid fa-bell"></i> <span>Alarm</span></a></li>
                <li><a href="@Url.Action("Index", "Analytics")"><i class="fa-solid fa-chart-line"></i> <span>Analytics</span></a></li>
                <li><a href="@Url.Action("Index", "Planner")"><i class="fa-solid fa-calendar-days"></i> <span>Planner</span></a></li>
                <li><a href="@Url.Action("Index", "DMS")"><i class="fa-solid fa-triangle-exclamation"></i> <span>DMS</span></a></li>
                <li class="nav-item"> <a href="@Url.Action("Index", "VASD")"> <i class="fas fa-tachometer-alt"></i> <span>VASD</span></a>
                </li>
            </ul>

            <!-- Sub Systems Dropdown -->
            <div class="sidebar-section">
                <div class="section-header" onclick="toggleSubSystems()">
                    <span>Sub Systems</span>
                    <i class="fa-solid fa-chevron-down" id="subSystemsIcon"></i>
                </div>
                <ul class="sidebar-submenu" id="subSystemsMenu">
                    <li><a href="@Url.Action("Index", "GISMap")"><i class="fa-solid fa-map"></i> <span>GIS Map</span></a></li>
                    <li><a href="@Url.Action("Index", "NMS")"><i class="fa-solid fa-network-wired"></i> <span>NMS</span></a></li>
                    <li><a href="@Url.Action("Index", "Logs")"><i class="fa-solid fa-file-lines"></i> <span>Logs</span></a></li>
                    <li><a href="@Url.Action("Index", "Assets")"><i class="fa-solid fa-boxes-stacked"></i> <span>Assets</span></a></li>
                    <li><a href="@Url.Action("Index", "UserManagement")"><i class="fa-solid fa-users"></i> <span>User Management</span></a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <h2>@ViewData["Title"]</h2>
                </div>

                <div class="header-right">
                    <div class="datetime">
                        <i class="fa-solid fa-clock"></i> <span id="currentTime">00:00:00</span>
                        <i class="fa-solid fa-temperature-three-quarters"></i> <span id="currentTemp">--°C</span>
                    </div>

                    <div class="user-info">
                        <i class="fa-solid fa-user-circle"></i>
                        <span>Admin</span>
                    </div>

                    <div class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
                        <i class="fa-solid fa-moon"></i>
                    </div>
                </div>
            </header>

            <!-- Page Body -->
            <main class="content-area">
                @RenderBody()
            </main>

            <!-- Footer -->
            <footer class="footer">
                <p>&copy; @DateTime.Now.Year VisionX Infrasys — ATMS. All rights reserved.</p>
            </footer>
        </div>
    </div>

    <!-- JS Section -->
    <script>
        // Sidebar Toggle
        const toggleBtn = document.getElementById('toggleSidebar');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');

        toggleBtn.addEventListener('click', function () {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        });

        // Toggle Sub Systems
        function toggleSubSystems() {
            const menu = document.getElementById('subSystemsMenu');
            const icon = document.getElementById('subSystemsIcon');
            menu.classList.toggle('show');
            icon.classList.toggle('rotated');
        }

        // Live Clock
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}:${seconds}`;
        }
        updateTime();
        setInterval(updateTime, 1000);

        // Weather (using Open-Meteo API)
        async function fetchWeather() {
            try {
                const response = await fetch(
                    'https://api.open-meteo.com/v1/forecast?latitude=20.2961&longitude=85.8245&current_weather=true'
                );
                const data = await response.json();
                const temp = Math.round(data.current_weather.temperature);
                document.getElementById('currentTemp').textContent = `${temp}°C`;
            } catch (error) {
                document.getElementById('currentTemp').textContent = 'N/A';
            }
        }
        fetchWeather();
        setInterval(fetchWeather, 600000); // update every 10 mins

        // Dark Mode Toggle
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        // Load previous theme from localStorage
        if (localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
        }

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeToggle.innerHTML = isDark
                ? '<i class="fa-solid fa-sun"></i>'
                : '<i class="fa-solid fa-moon"></i>';
        });
    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>