@{
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
    ViewData["Title"] = "Planner";
}

<div class="planner-page">
    <!-- Calendar Header -->
    <div class="calendar-header">
        <div class="header-left">
            <button class="btn-today" id="btnToday">Today</button>
            <div class="nav-buttons">
                <button class="btn-nav" id="btnPrev"><i class="fa-solid fa-chevron-left"></i></button>
                <button class="btn-nav" id="btnNext"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
            <h3 class="current-month" id="currentMonth">June 2025</h3>
        </div>

        <div class="header-center">
            <div class="task-filter">
                <i class="fa-solid fa-circle task-indicator"></i>
                <select class="filter-dropdown" id="taskFilter">
                    <option value="all">All Tasks</option>
                    <option value="personal">Personal</option>
                    <option value="work">Work</option>
                    <option value="important">Important</option>
                </select>
            </div>
        </div>

        <div class="header-right">
            <button class="btn-view active" data-view="month">MONTH</button>
            <button class="btn-view" data-view="week">WEEK</button>
            <button class="btn-view" data-view="day">DAY</button>
        </div>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-container">
        <div class="calendar-grid">
            <!-- Weekday Headers -->
            <div class="calendar-weekdays">
                <div class="weekday">Sun</div>
                <div class="weekday">Mon</div>
                <div class="weekday">Tue</div>
                <div class="weekday">Wed</div>
                <div class="weekday">Thu</div>
                <div class="weekday">Fri</div>
                <div class="weekday">Sat</div>
            </div>

            <!-- Calendar Days -->
            <div class="calendar-days" id="calendarDays">
                <!-- Days will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Task Details Modal -->
    <div class="task-modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Task Details</h4>
                <button class="btn-close" onclick="closeTaskModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Task Title</label>
                    <input type="text" class="form-input" id="taskTitle" placeholder="Enter task title">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea class="form-input" id="taskDescription" rows="3" placeholder="Enter description"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" class="form-input" id="taskDate">
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" class="form-input" id="taskTime">
                    </div>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select class="form-input" id="taskCategory">
                        <option value="personal">Personal</option>
                        <option value="work">Work</option>
                        <option value="important">Important</option>
                        <option value="meeting">Meeting</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeTaskModal()">Cancel</button>
                <button class="btn-save" onclick="saveTask()">Save Task</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Current date tracking
    let currentDate = new Date();
    let selectedDate = null;
    let tasks = [
        {
            id: 1,
            date: '2025-06-03',
            title: 'Team Meeting',
            category: 'work',
            time: '10:00'
        }
    ];

    // Initialize calendar
    function initCalendar() {
        renderCalendar();
        updateMonthDisplay();
    }

    // Render calendar days
    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const prevLastDay = new Date(year, month, 0);

        const firstDayIndex = firstDay.getDay();
        const lastDayDate = lastDay.getDate();
        const prevLastDayDate = prevLastDay.getDate();

        const calendarDays = document.getElementById('calendarDays');
        calendarDays.innerHTML = '';

        // Previous month days
        for (let i = firstDayIndex; i > 0; i--) {
            const dayDiv = createDayElement(prevLastDayDate - i + 1, 'prev-month');
            calendarDays.appendChild(dayDiv);
        }

        // Current month days
        const today = new Date();
        for (let i = 1; i <= lastDayDate; i++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
            const isToday = (today.getDate() === i && today.getMonth() === month && today.getFullYear() === year);
            const dayDiv = createDayElement(i, 'current-month', dateStr, isToday);

            // Add tasks for this day
            const dayTasks = tasks.filter(task => task.date === dateStr);
            if (dayTasks.length > 0) {
                dayTasks.forEach(task => {
                    const taskIndicator = document.createElement('div');
                    taskIndicator.className = `task-dot task-${task.category}`;
                    taskIndicator.title = task.title;
                    dayDiv.appendChild(taskIndicator);
                });
            }

            calendarDays.appendChild(dayDiv);
        }

        // Next month days
        const remainingDays = 42 - (firstDayIndex + lastDayDate);
        for (let i = 1; i <= remainingDays; i++) {
            const dayDiv = createDayElement(i, 'next-month');
            calendarDays.appendChild(dayDiv);
        }
    }

    // Create day element
    function createDayElement(day, monthClass, dateStr = null, isToday = false) {
        const dayDiv = document.createElement('div');
        dayDiv.className = `calendar-day ${monthClass}`;

        if (isToday) {
            dayDiv.classList.add('today');
        }

        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        dayDiv.appendChild(dayNumber);

        if (dateStr && monthClass === 'current-month') {
            dayDiv.dataset.date = dateStr;
            dayDiv.addEventListener('click', () => openTaskModal(dateStr));
        }

        return dayDiv;
    }

    // Update month display
    function updateMonthDisplay() {
        const months = ['January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'];
        const monthDisplay = `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
        document.getElementById('currentMonth').textContent = monthDisplay;
    }

    // Navigate months
    function prevMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
        updateMonthDisplay();
    }

    function nextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
        updateMonthDisplay();
    }

    function goToToday() {
        currentDate = new Date();
        renderCalendar();
        updateMonthDisplay();
    }

    // Task modal functions
    function openTaskModal(dateStr) {
        selectedDate = dateStr;
        document.getElementById('taskDate').value = dateStr;
        document.getElementById('taskModal').classList.add('active');
    }

    function closeTaskModal() {
        document.getElementById('taskModal').classList.remove('active');
        clearTaskForm();
    }

    function clearTaskForm() {
        document.getElementById('taskTitle').value = '';
        document.getElementById('taskDescription').value = '';
        document.getElementById('taskTime').value = '';
        document.getElementById('taskCategory').value = 'personal';
    }

    function saveTask() {
        const title = document.getElementById('taskTitle').value;
        const date = document.getElementById('taskDate').value;
        const time = document.getElementById('taskTime').value;
        const category = document.getElementById('taskCategory').value;
        const description = document.getElementById('taskDescription').value;

        if (!title || !date) {
            alert('Please fill in required fields');
            return;
        }

        const newTask = {
            id: tasks.length + 1,
            date: date,
            title: title,
            category: category,
            time: time,
            description: description
        };

        tasks.push(newTask);
        renderCalendar();
        closeTaskModal();
    }

    // Event listeners
    document.getElementById('btnToday').addEventListener('click', goToToday);
    document.getElementById('btnPrev').addEventListener('click', prevMonth);
    document.getElementById('btnNext').addEventListener('click', nextMonth);

    // View buttons
    document.querySelectorAll('.btn-view').forEach(btn => {
        btn.addEventListener('click', function () {
            document.querySelectorAll('.btn-view').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            // View switching logic can be added here
        });
    });

    // Close modal on outside click
    document.getElementById('taskModal').addEventListener('click', function (e) {
        if (e.target === this) {
            closeTaskModal();
        }
    });

    // Initialize on page load
    window.addEventListener('load', initCalendar);
</script>