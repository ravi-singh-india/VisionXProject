@{
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
    ViewData["Title"] = "User Management";
}

<div class="user-management-page">
    <!-- Page Header -->
    <div class="page-header">
        <h3>User Management</h3>
        <button class="btn-create" onclick="openCreateUserModal()">
            <i class="fa-solid fa-plus"></i> Create
        </button>
    </div>

    <!-- Manage Your Account Section -->
    <div class="account-section">
        <h5>Manage your account</h5>
        <div class="user-card">
            <div class="user-info">
                <div class="user-details">
                    <span class="user-label">Username</span>
                    <span class="user-value">Dats</span>
                </div>
                <div class="user-details">
                    <span class="user-label">Role</span>
                    <span class="user-role">Admin</span>
                </div>
            </div>
            <button class="btn-edit" onclick="editUser('admin', 'Dats', 'Admin')">Edit</button>
        </div>
    </div>

    <!-- Manage Other Users Section -->
    <div class="users-section">
        <h5>Manage other users</h5>

        <div class="users-list" id="usersList">
            <!-- Users will be populated by JavaScript -->
        </div>
    </div>

    <!-- Create/Edit User Modal -->
    <div class="user-modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="modalTitle">Create New User</h4>
                <button class="btn-close" onclick="closeUserModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Username <span class="required">*</span></label>
                    <input type="text" class="form-input" id="username" placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label>Password <span class="required">*</span></label>
                    <input type="password" class="form-input" id="password" placeholder="Enter password">
                </div>
                <div class="form-group">
                    <label>Confirm Password <span class="required">*</span></label>
                    <input type="password" class="form-input" id="confirmPassword" placeholder="Confirm password">
                </div>
                <div class="form-group">
                    <label>Role <span class="required">*</span></label>
                    <select class="form-input" id="userRole">
                        <option value="">Select Role</option>
                        <option value="Admin">Admin</option>
                        <option value="User">User</option>
                        <option value="Developer">Developer</option>
                        <option value="Viewer">Viewer</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeUserModal()">Cancel</button>
                <button class="btn-save" onclick="saveUser()">
                    <i class="fa-solid fa-save"></i> Save User
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Sample users data
    let users = [
        { id: 1, username: 'tester user 1', role: 'User' },
        { id: 2, username: 'testuser', role: 'Developer' },
        { id: 3, username: 'Sai', role: 'User' },
        { id: 4, username: 'raj', role: 'User' },
        { id: 5, username: 'admin2', role: 'Admin' }
    ];

    let editingUserId = null;

    // Render users list
    function renderUsers() {
        const container = document.getElementById('usersList');
        container.innerHTML = '';

        users.forEach(user => {
            const userCard = document.createElement('div');
            userCard.className = 'user-card';
            userCard.innerHTML = `
                    <div class="user-info">
                        <div class="user-details">
                            <span class="user-label">Username</span>
                            <span class="user-value">${user.username}</span>
                        </div>
                        <div class="user-details">
                            <span class="user-label">Role</span>
                            <span class="user-role role-${user.role.toLowerCase()}">${user.role}</span>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="btn-edit" onclick="editUser(${user.id}, '${user.username}', '${user.role}')">Edit</button>
                        <button class="btn-delete" onclick="deleteUser(${user.id})">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `;
            container.appendChild(userCard);
        });
    }

    // Open create user modal
    function openCreateUserModal() {
        editingUserId = null;
        document.getElementById('modalTitle').textContent = 'Create New User';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        document.getElementById('confirmPassword').value = '';
        document.getElementById('userRole').value = '';
        document.getElementById('userModal').classList.add('active');
    }

    // Edit user
    function editUser(userId, username, role) {
        if (userId === 'admin') {
            // Editing admin account
            editingUserId = 'admin';
            document.getElementById('modalTitle').textContent = 'Edit Your Account';
            document.getElementById('username').value = username;
            document.getElementById('username').disabled = true;
            document.getElementById('password').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('userRole').value = role;
            document.getElementById('userRole').disabled = true;
        } else {
            // Editing other user
            editingUserId = userId;
            const user = users.find(u => u.id === userId);
            if (user) {
                document.getElementById('modalTitle').textContent = 'Edit User';
                document.getElementById('username').value = user.username;
                document.getElementById('username').disabled = false;
                document.getElementById('password').value = '';
                document.getElementById('confirmPassword').value = '';
                document.getElementById('userRole').value = user.role;
                document.getElementById('userRole').disabled = false;
            }
        }
        document.getElementById('userModal').classList.add('active');
    }

    // Delete user
    function deleteUser(userId) {
        if (confirm('Are you sure you want to delete this user?')) {
            const index = users.findIndex(u => u.id === userId);
            if (index > -1) {
                users.splice(index, 1);
                renderUsers();
            }
        }
    }

    // Save user
    function saveUser() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const role = document.getElementById('userRole').value;

        // Validation
        if (!username || !role) {
            alert('Please fill in all required fields');
            return;
        }

        if (editingUserId === null && (!password || !confirmPassword)) {
            alert('Please enter password for new user');
            return;
        }

        if (password && password !== confirmPassword) {
            alert('Passwords do not match');
            return;
        }

        if (editingUserId === 'admin') {
            // Update admin account
            alert('Admin account updated successfully');
        } else if (editingUserId) {
            // Update existing user
            const user = users.find(u => u.id === editingUserId);
            if (user) {
                user.username = username;
                user.role = role;
            }
        } else {
            // Create new user
            const newUser = {
                id: users.length + 1,
                username: username,
                role: role
            };
            users.push(newUser);
        }

        renderUsers();
        closeUserModal();
    }

    // Close modal
    function closeUserModal() {
        document.getElementById('userModal').classList.remove('active');
        document.getElementById('username').disabled = false;
        document.getElementById('userRole').disabled = false;
    }

    // Close modal on outside click
    document.getElementById('userModal')?.addEventListener('click', function (e) {
        if (e.target === this) {
            closeUserModal();
        }
    });

    // Initialize on page load
    window.addEventListener('load', renderUsers);
</script>